<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Class Manager</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <link rel="stylesheet" href="style.css">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' https: data: blob: 'unsafe-inline' 'unsafe-eval';">
  <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
</head>
<body>

  <!-- Loading Screen -->
<div id="loader">
  <div class="loader-content">
    <img src="assets/logo.png" alt="Class Manager Logo" class="logo-img">
    <div class="dots">
      <span></span>
      <span></span>
      <span></span>
    </div>
    <p>Preparing your workspace</p>
  </div>
</div>

<!-- Auth Container -->
<div class="auth-container">
  <div class="auth-header">
    <h1>Class Manager</h1>
    <p>Manage your classes efficiently</p>
  </div>

  <!-- Tab Switcher -->
  <div class="tab-switcher">
    <button class="tab-btn active" onclick="switchTab('login')">Login</button>
    <button class="tab-btn" onclick="switchTab('signup')">Sign Up</button>
  </div>

  <!-- Alert Message -->
  <div id="alert" class="alert"></div>

  <!-- Login Form -->
  <form class="auth-form active" id="loginForm" onsubmit="handleLogin(event)">
    <div class="input-group">
      <label for="loginEmail">Email address</label>
      <input type="email" id="loginEmail" placeholder="you@example.com" required>
    </div>

    <div class="input-group">
      <label for="loginPassword">Password</label>
      <input type="password" id="loginPassword" placeholder="Enter your password" required>
      <span class="password-toggle" onclick="togglePassword('loginPassword')">üëÅÔ∏è</span>
    </div>

    <div class="forgot-password">
      <a href="#" onclick="alert('Password reset feature coming soon!'); return false;">Forgot password?</a>
    </div>

    <button type="submit" class="btn btn-primary" id="loginBtn">
      <span>Login to your account</span>
    </button>

    <div class="divider"><span>OR</span></div>

    <button type="button" class="btn btn-google" onclick="googleLogin()">
      <img src="https://www.svgrepo.com/show/475656/google-color.svg" alt="Google">
      <span>Continue with Google</span>
    </button>
  </form>

  <!-- Sign Up Form -->
  <form class="auth-form" id="signupForm" onsubmit="handleSignup(event)">
    <div class="input-group">
      <label for="signupEmail">Email address</label>
      <input type="email" id="signupEmail" placeholder="you@example.com" required>
    </div>

    <div class="input-group">
      <label for="signupPassword">Password</label>
      <input type="password" id="signupPassword" placeholder="At least 6 characters" required minlength="6">
      <span class="password-toggle" onclick="togglePassword('signupPassword')">üëÅÔ∏è</span>
    </div>

    <div class="input-group">
      <label for="confirmPassword">Confirm Password</label>
      <input type="password" id="confirmPassword" placeholder="Re-enter your password" required minlength="6">
      <span class="password-toggle" onclick="togglePassword('confirmPassword')">üëÅÔ∏è</span>
    </div>

    <button type="submit" class="btn btn-primary" id="signupBtn">
      <span>Create account</span>
    </button>

    <div class="divider"><span>OR</span></div>

    <button type="button" class="btn btn-google" onclick="googleLogin()">
      <img src="https://www.svgrepo.com/show/475656/google-color.svg" alt="Google">
      <span>Sign up with Google</span>
    </button>
  </form>
</div>
  
<script type="module" src="auth.js"></script>
<script>  
  emailjs.init("rHYrJYPEObugXQPep");
  // Loading screen
  window.addEventListener("load", () => {
    setTimeout(() => {
      document.getElementById("loader").classList.add("hide-loader");
    }, 2500);
  });

  // Tab switching
  function switchTab(tab) {
    const tabs = document.querySelectorAll('.tab-btn');
    const forms = document.querySelectorAll('.auth-form');
    
    tabs.forEach(t => t.classList.remove('active'));
    forms.forEach(f => f.classList.remove('active'));
    
    if (tab === 'login') {
      tabs[0].classList.add('active');
      document.getElementById('loginForm').classList.add('active');
    } else {
      tabs[1].classList.add('active');
      document.getElementById('signupForm').classList.add('active');
    }
    
    hideAlert();
  }

  // Password toggle
  function togglePassword(inputId) {
    const input = document.getElementById(inputId);
    input.type = input.type === 'password' ? 'text' : 'password';
  }

  // Alert functions
  function showAlert(message, type = 'error') {
    const alert = document.getElementById('alert');
    alert.textContent = message;
    alert.className = `alert alert-${type} show`;
  }

  function hideAlert() {
    const alert = document.getElementById('alert');
    alert.classList.remove('show');
  }

  // Login handler
  function handleLogin(e) {
    e.preventDefault();
    hideAlert();
    
    const btn = document.getElementById('loginBtn');
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;
    
    btn.disabled = true;
    btn.innerHTML = '<span class="spinner"></span><span>Logging in...</span>';
    
    // Call your Firebase login function
    window.login(email, password, (error) => {
      btn.disabled = false;
      btn.innerHTML = '<span>Login to your account</span>';
      
      if (error) {
        showAlert(error, 'error');
      }
    });
  }

  // Signup handler
  function handleSignup(e) {
    e.preventDefault();
    hideAlert();
    
    const email = document.getElementById('signupEmail').value;
    const password = document.getElementById('signupPassword').value;
    const confirm = document.getElementById('confirmPassword').value;
    const btn = document.getElementById('signupBtn');
    
    if (password !== confirm) {
      showAlert('Passwords do not match!', 'error');
      return;
    }
    
    btn.disabled = true;
    btn.innerHTML = '<span class="spinner"></span><span>Creating account...</span>';
    
    // Call your Firebase signup function
    window.signUp(email, password, (error) => {
      btn.disabled = false;
      btn.innerHTML = '<span>Create account</span>';
      
      if (error) {
        showAlert(error, 'error');
      }
    });
  }
  
  function sendLoginEmail(userEmail) {    
    emailjs.send("service_jcmia18", "template_c34t4jt", {    
      user_email: userEmail,    
      login_time: new Date().toLocaleString(),    
      device: navigator.userAgent  
    });
  }

  // üìß Email/Password Login - Updated for new form 
  window.login = function (email, password, callback) {    
    signInWithEmailAndPassword(auth, email, password)        
      .then((userCredential) => {      
      
        // ‚úÖ SEND LOGIN EMAIL      
        sendLoginEmail(userCredential.user.email);
      
        // ‚úÖ REDIRECT      
        window.location.href = "app.html";        
      })        
      .catch((error) => {          
        if (callback) callback(error.message);        
      });
  };

  // ‚úçÔ∏è Sign Up - Updated for new form
  window.signUp = function (email, password, callback) {    
    if (password.length < 6) {        
      if (callback) callback("Password must be at least 6 characters");       
      return;    
    }
  
    createUserWithEmailAndPassword(auth, email, password)        
      .then((userCredential) => {     
      
        // ‚úÖ SEND LOGIN EMAIL      
        sendLoginEmail(userCredential.user.email);
      
        window.location.href = "app.html";       
      })        
      .catch((error) => {            
        if (callback) callback(error.message);        
      });
  };
  
  // üîµ Google Login  
  window.googleLogin = function () {    
    const provider = new GoogleAuthProvider();
      
    signInWithPopup(auth, provider)        
      .then((result) => {      
      
        // ‚úÖ SEND LOGIN EMAIL     
        sendLoginEmail(result.user.email);
      
        window.location.href = "app.html";        
      })        
      .catch((error) => {            
        alert("Google login failed: " + error.message);        
      });
  };

</script>
</body>
</html>






