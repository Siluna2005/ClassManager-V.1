<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#2563EB">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https: data: blob: 'unsafe-inline' 'unsafe-eval'; connect-src 'self' https: wss: data: blob:;">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
    <title>Class Manager</title>
    <link rel="stylesheet" href="appStyle.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>

    <div id="app" class="container">
        <nav class="navbar">
            <div class="navbar-content">
                <div class="navbar-brand">
                    <img src="assets/favicon.ico" alt="Logo" class="nav-logo">
                    <span class="navbar-title">Class Manager</span>
                </div>
                <div style="display: flex; align-items: center; gap: 15px;">        
                    <div id="syncStatus" style="font-size: 12px; color: rgba(255,255,255,0.8);">            
                        <span id="syncIcon">‚òÅÔ∏è</span> <span id="syncText">Synced</span>        
                    </div>       
                    <button class="menu-btn" onclick="toggleSidebar()">‚ò∞</button>
                </div>
            </div>
        </nav>

        <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3>Teacher Portal</h3>
                <p>Welcome back!</p>
            </div>
            <div class="sidebar-menu">
                <!-- Admin Panel (Only visible to admins) -->
                <div class="menu-item" data-screen="admin-panel" onclick="navigateTo('admin-panel')" id="adminMenuItem" style="display: none;">    
                    <span>üëë</span><span>Admin Panel</span>
                </div>
                <div class="menu-item active" data-screen="dashboard" onclick="navigateTo('dashboard')">
                    <span>üìä</span><span>Dashboard</span>
                </div>
                <div class="menu-item" data-screen="students" onclick="navigateTo('students')">
                    <span>üë•</span><span>Students</span>
                </div>
                <div class="menu-item" data-screen="timetable" onclick="navigateTo('timetable')">
                    <span>üìÖ</span><span>Timetable</span>
                </div>
                <div class="menu-item" data-screen="attendance" onclick="navigateTo('attendance')">
                    <span>‚úÖ</span><span>Attendance</span>
                </div>
                <div class="menu-item" data-screen="payments" onclick="navigateTo('payments')">
                    <span>üí∞</span><span>Payments</span>
                </div>
                <div class="menu-item" data-screen="reports" onclick="navigateTo('reports')">
                    <span>üìÑ</span><span>Reports</span>
                </div>
                <div class="menu-item" data-screen="subscription" onclick="navigateTo('subscription')">        
                    <span>‚≠ê</span><span>Subscription</span>    
                </div>
                <div class="menu-item" data-screen="settings" onclick="navigateTo('settings')">
                    <span>‚öôÔ∏è</span><span>Settings</span>
                </div>
                <div class="menu-item" onclick="logout()">
                    <span>üö™</span><span>Logout</span>
                </div>
            </div>
        </div>

        <div class="content">
          
            <!-- Admin Panel Screen -->
            <div id="admin-panel" class="screen">    
                <div class="screen-header">       
                    <h1 class="screen-title">üëë Admin Control Panel</h1>      
                    <p class="screen-subtitle">System administration and user management</p>   
                </div>
   
                <!-- Admin Stats Dashboard -->    
                <div class="stats-grid">     
                    <div class="stat-card">      
                        <div class="stat-header">        
                            <div class="stat-info">        
                                <p>Total Users</p>           
                                <h3 id="adminTotalUsers">0</h3>          
                            </div>           
                            <div class="stat-icon blue">üë•</div>          
                        </div>       
                    </div>
         
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-info">
                                <p>Active Subscriptions</p>
                                <h3 id="adminActiveSubscriptions">0</h3> 
                            </div>  
                            <div class="stat-icon green">üí≥</div> 
                        </div> 
                    </div>
         
                    <div class="stat-card">        
                        <div class="stat-header">       
                            <div class="stat-info">         
                                <p>Total Students</p>          
                                <h3 id="adminTotalStudents">0</h3>         
                            </div>         
                            <div class="stat-icon purple">üéì</div>         
                        </div>       
                    </div>
                
                    <div class="stat-card">      
                        <div class="stat-header">
                                  <div class="stat-info">        
                                <p>Total Revenue</p>        
                                <h3 id="adminTotalRevenue">LKR 0</h3>                
                            </div>             
                            <div class="stat-icon amber">üí∞</div>         
                        </div>       
                    </div>    
                </div>
   
                <!-- Admin Tabs --> 
                <div class="card" style="margin-top: 20px;">      
                    <div class="admin-tabs" style="display: flex; gap: 10px; border-bottom: 2px solid #e5e7eb; padding-bottom: 10px; margin-bottom: 20px;">          
                        <button class="admin-tab active" onclick="showAdminTab('users')" style="padding: 10px 20px; border: none; background: #2563EB; color: white; border-radius: 8px; cursor: pointer; font-weight: 600;">All Users</button>           
                        <button class="admin-tab" onclick="showAdminTab('subscriptions')" style="padding: 10px 20px; border: none; background: #f3f4f6; color: #374151; border-radius: 8px; cursor: pointer; font-weight: 600;">Subscriptions</button>           
                        <button class="admin-tab" onclick="showAdminTab('analytics')" style="padding: 10px 20px; border: none; background: #f3f4f6; color: #374151; border-radius: 8px; cursor: pointer; font-weight: 600;">Analytics</button>           
                        <button class="admin-tab" onclick="showAdminTab('settings')" style="padding: 10px 20px; border: none; background: #f3f4f6; color: #374151; border-radius: 8px; cursor: pointer; font-weight: 600;">Admin Settings</button>    
                    </div>
        
                    <!-- Users Tab -->      
                    <div id="admin-users-tab" class="admin-tab-content active">         
                        <h3 class="card-title">All Registered Users</h3>
                     
                        <div class="form-group" style="max-width: 400px;">            
                            <input type="text" id="adminUserSearch" placeholder="üîç Search users by email or ID..." onkeyup="filterAdminUsers()" style="padding: 10px; border: 1px solid #e5e7eb; border-radius: 8px; width: 100%;">           
                        </div>
                 
                        <div style="overflow-x: auto; margin-top: 20px;">                
                            <table class="data-table" style="width: 100%; border-collapse: collapse;">   
                                <thead>    
                                    <tr style="background: #f3f4f6; text-align: left;">     
                                        <th style="padding: 12px; border-bottom: 2px solid #e5e7eb;">Email</th>     
                                        <th style="padding: 12px; border-bottom: 2px solid #e5e7eb;">User ID</th>         
                                        <th style="padding: 12px; border-bottom: 2px solid #e5e7eb;">Students</th>        
                                        <th style="padding: 12px; border-bottom: 2px solid #e5e7eb;">Subscription</th>        
                                        <th style="padding: 12px; border-bottom: 2px solid #e5e7eb;">Status</th>       
                                        <th style="padding: 12px; border-bottom: 2px solid #e5e7eb;">Actions</th>       
                                    </tr>        
                                </thead>                   
                                <tbody id="adminUsersTableBody">                      
                                    <tr>                         
                                        <td colspan="6" style="text-align: center; padding: 40px; color: #9ca3af;">                            
                                            Click "All Users" tab to load data                          
                                        </td>                       
                                    </tr>                    
                                </tbody>                        
                            </table>         
                        </div>    
                    </div>
       
                    <!-- Subscriptions Tab -->      
                    <div id="admin-subscriptions-tab" class="admin-tab-content" style="display: none;">        
                        <h3 class="card-title">Subscription Overview</h3>         
                        <div id="adminSubscriptionsList">         
                            <p>Subscription management tools coming soon...</p>        
                        </div>      
                    </div>
 
                    <!-- Admin Analytics Tab -->
                    <div id="admin-analytics-tab" class="admin-tab-content" style="display: none;">   
                        <h2 style="color: #f1f5f9; margin-bottom: 24px; font-family: Sora, sans-serif;">üìä Analytics Overview</h2>    
   
                        <!-- Statistics Cards -->    
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px;">
               
                            <!-- Total Users Card -->        
                            <div class="card" style="background: linear-gradient(135deg, rgba(139,92,246,0.2) 0%, rgba(139,92,246,0.05) 100%); border: 1px solid rgba(139,92,246,0.3);">            
                                <p style="color: #f1f5f9; font-size: 12px; margin: 0 0 8px 0; text-transform: uppercase; letter-spacing: 1px; font-weight: 700; color: #a78bfa !important;">Total Users</p>            
                                <h2 id="adminTotalUsers" style="color: #f1f5f9; font-size: 36px; font-weight: 800; margin: 0; letter-spacing: -1px;">0</h2>            
                                <p style="color: #f1f5f9; font-size: 12px; margin: 8px 0 0 0; color: #94a3b8;">Registered accounts</p>        
                            </div>
               
                            <!-- Active Users Card -->       
                            <div class="card" style="background: linear-gradient(135deg, rgba(16,185,129,0.2) 0%, rgba(16,185,129,0.05) 100%); border: 1px solid rgba(16,185,129,0.3);">          
                                <p style="color: #f1f5f9; font-size: 12px; margin: 0 0 8px 0; text-transform: uppercase; letter-spacing: 1px; font-weight: 700; color: #34d399 !important;">Active This Month</p>          
                                <h2 id="adminActiveUsers" style="color: #f1f5f9; font-size: 36px; font-weight: 800; margin: 0; letter-spacing: -1px;">0</h2>          
                                <p style="color: #f1f5f9; font-size: 12px; margin: 8px 0 0 0; color: #94a3b8;">Users with activity</p>      
                            </div>
             
                            <!-- New Users Card -->      
                            <div class="card" style="background: linear-gradient(135deg, rgba(59,130,246,0.2) 0%, rgba(59,130,246,0.05) 100%); border: 1px solid rgba(59,130,246,0.3);">         
                                <p style="color: #f1f5f9; font-size: 12px; margin: 0 0 8px 0; text-transform: uppercase; letter-spacing: 1px; font-weight: 700; color: #60a5fa !important;">New This Month</p>          
                                <h2 id="adminNewUsers" style="color: #f1f5f9; font-size: 36px; font-weight: 800; margin: 0; letter-spacing: -1px;">0</h2>        
                                <p style="color: #f1f5f9; font-size: 12px; margin: 8px 0 0 0; color: #94a3b8;">Recent signups</p>       
                            </div>  
                        </div>
        
                        <!-- User Growth Chart -->   
                        <div class="card">      
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">         
                                <h3 class="card-title" style="margin: 0; color: #f1f5f9;">üìà User Growth</h3>         
                                <button class="btn btn-secondary" onclick="createAdminUserGrowthChart()" style="padding: 8px 16px; font-size: 13px;">          
                                    üîÑ Refresh          
                                </button>       
                            </div>
            
                            <!-- Chart Container -->       
                            <div style="position: relative; height: 350px; background: rgba(255,255,255,0.04); border-radius: 12px; padding: 20px;">         
                                <canvas id="adminUserGrowthChart"></canvas>       
                            </div>
               
                            <!-- Chart Info -->        
                            <div style="margin-top: 16px; padding: 12px; background: rgba(139,92,246,0.1); border-radius: 8px; border-left: 4px solid #8b5cf6;">            
                                <p style="color: #f1f5f9; font-size: 13px; margin: 0; line-height: 1.6; color: #cbd5e1;">             
                                    <strong>üìä User Growth Tracking:</strong> This chart shows the cumulative growth of registered users over time. Each point represents the total number of users who have signed up by that date.            
                                </p>        
                            </div>   
                        </div>
       
                        <!-- Additional Analytics -->   
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 16px; margin-top: 24px;">
               
                            <!-- User Activity Card -->        
                            <div class="card">            
                                <h3 class="card-title" style="color: #f1f5f9;">üìä User Activity</h3>            
                                <div style="padding: 12px; background: rgba(255,255,255,0.04); border-radius: 8px; margin-bottom: 12px;">               
                                    <div style="display: flex; justify-content: space-between; align-items: center;">                    
                                        <span style="color: #f1f5f9; font-size: 13px; color: #94a3b8;">Daily Active Users</span>                    
                                        <strong id="adminDAU" style="color: #f1f5f9; font-size: 16px;">0</strong>                
                                    </div>           
                                </div>            
                                <div style="padding: 12px; background: rgba(255,255,255,0.04); border-radius: 8px; margin-bottom: 12px;">               
                                    <div style="display: flex; justify-content: space-between; align-items: center;">                    
                                        <span style="color: #f1f5f9; font-size: 13px; color: #94a3b8;">Weekly Active Users</span>                    
                                        <strong id="adminWAU" style="color: #f1f5f9; font-size: 16px;">0</strong>                
                                    </div>           
                                </div>            
                                <div style="padding: 12px; background: rgba(255,255,255,0.04); border-radius: 8px;">               
                                    <div style="display: flex; justify-content: space-between; align-items: center;">                   
                                        <span style="color: #f1f5f9; font-size: 13px; color: #94a3b8;">Monthly Active Users</span>                   
                                        <strong id="adminMAU" style="color: #f1f5f9; font-size: 16px;">0</strong>               
                                    </div>            
                                </div>        
                            </div>
                
                            <!-- User Retention Card -->        
                            <div class="card">            
                                <h3 class="card-title" style="color: #f1f5f9;">üéØ User Retention</h3>            
                                <div style="padding: 12px; background: rgba(255,255,255,0.04); border-radius: 8px; margin-bottom: 12px;">                
                                    <div style="display: flex; justify-content: space-between; align-items: center;">                   
                                        <span style="color: #f1f5f9; font-size: 13px; color: #94a3b8;">7-Day Retention</span>                   
                                        <strong id="admin7DayRetention" style="color: #10b981;">0%</strong>                
                                    </div>            
                                </div>           
                                <div style="padding: 12px; background: rgba(255,255,255,0.04); border-radius: 8px; margin-bottom: 12px;">              
                                    <div style="display: flex; justify-content: space-between; align-items: center;">              
                                        <span style="color: #f1f5f9; font-size: 13px; color: #94a3b8;">30-Day Retention</span>              
                                        <strong id="admin30DayRetention" style="color: #10b981;">0%</strong>             
                                    </div>           
                                </div>            
                                <div style="padding: 12px; background: rgba(255,255,255,0.04); border-radius: 8px;">                
                                    <div style="display: flex; justify-content: space-between; align-items: center;">                    
                                        <span style="color: #f1f5f9; font-size: 13px; color: #94a3b8;">90-Day Retention</span>                    
                                        <strong id="admin90DayRetention" style="color: #10b981;">0%</strong>                
                                    </div>           
                                </div>        
                            </div>   
                        </div>
                    </div>
     
                    <!-- Admin Settings Tab -->    
                    <div id="admin-settings-tab" class="admin-tab-content" style="display: none;">      
                        <h3 class="card-title" style="color: #f1f5f9;">Admin Management</h3>            
     
                        <div class="card" style="background: #1e293b; padding: 24px; margin: 20px 0; border-radius: 14px; border: 1px solid rgba(255,255,255,0.08);">     
                            <h4 style="margin-top: 0; color: #f1f5f9; font-family: Sora, sans-serif; font-size: 16px; font-weight: 700; margin-bottom: 20px;">Add New Admin</h4>
                               
                            <div class="form-group">              
                                <label>Email Address</label>              
                                <input type="email" id="newAdminEmail" placeholder="admin@example.com" style="padding: 11px 14px; background: #162032; border: 1.5px solid rgba(255,255,255,0.08); border-radius: 10px; width: 100%; max-width: 400px; color: #f1f5f9; font-size: 14px; font-family: DM Sans, sans-serif; transition: border-color 0.2s;" onfocus="this.style.borderColor='#14b8a6'" onblur="this.style.borderColor='rgba(255,255,255,0.08)'">           
                            </div>
                              
                            <div class="form-group">                 
                                <label>Admin Role</label>                 
                                <select id="newAdminRole" style="padding: 11px 14px; background: #162032; border: 1.5px solid rgba(255,255,255,0.08); border-radius: 10px; width: 100%; max-width: 400px; color: #f1f5f9; font-size: 14px; font-family: DM Sans, sans-serif; cursor: pointer; color-scheme: dark;" onfocus="this.style.borderColor='#14b8a6'" onblur="this.style.borderColor='rgba(255,255,255,0.08)'">                   
                                    <option value="super_admin">Super Admin (Full Access)</option>        
                                    <option value="support_admin">Support Admin (User Management)</option>                     
                                    <option value="analytics_admin">Analytics Admin (View Only)</option>                 
                                </select>                  
                                <p style="font-size: 12px; color: #94a3b8; margin-top: 8px;">                  
                                    ‚ö†Ô∏è The user must have an account before being made an admin                
                                </p>              
                            </div>
                               
                            <button class="btn btn-primary" onclick="addNewAdmin()" style="margin-top: 10px;">             
                                ‚ûï Add Admin             
                            </button>
                        </div>
                      
                        <div id="adminsList" style="margin-top: 30px;">            
                            <h3 style="color: #f1f5f9; font-family: Sora, sans-serif; font-size: 18px; font-weight: 700; margin-bottom: 16px;">Current Admins</h3>            
                            <p style="color: #64748b; font-size: 14px;">Loading...</p>          
                        </div>      
                    </div>   
                </div>
            </div>
            
            <!-- Dashboard Screen -->
            <div id="dashboard" class="screen active">
                <div class="screen-header">
                    <h1 class="screen-title">Dashboard</h1>
                    <p class="screen-subtitle">Welcome back! Here's your overview</p>
                </div>
                <div class="form-group" style="max-width: 300px;">
                    <label>Filter by Grade</label>
                    <select id="gradeFilter" onchange="updateDashboard()">
                        <option value="all">All Grades</option>
                    </select>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-info">
                                <p>Total Students</p>
                                <h3 id="totalStudents">0</h3>
                            </div>
                            <div class="stat-icon blue">üë•</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-info">
                                <p>Today's Classes</p>
                                <h3 id="todayClasses">0</h3>
                            </div>
                            <div class="stat-icon green">üìÖ</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-info">
                                <p>Pending Payments</p>
                                <h3 id="pendingPayments">0</h3>
                            </div>
                            <div class="stat-icon amber">‚ö†Ô∏è</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-info">
                                <p>Attendance Rate</p>
                                <h3 id="attendanceRate">0%</h3>
                            </div>
                            <div class="stat-icon purple">‚úÖ</div>
                        </div>
                    </div>
                </div>
                <div class="grid-2">
                    <div class="card">
                        <h3 class="card-title">Quick Actions</h3>
                        <button class="btn btn-primary" onclick="navigateTo('attendance')" style="margin-bottom: 12px;">‚úÖ Mark Attendance</button>
                        <button class="btn btn-success" onclick="navigateTo('payments')" style="margin-bottom: 12px;">üí∞ Record Payment</button>
                        <button class="btn btn-secondary" onclick="navigateTo('reports')">üìÑ Generate Report</button>
                    </div>
                    <div class="card">
                        <h3 class="card-title">Today's Classes</h3>
                        <div id="todayClassesList"></div>
                    </div>
                </div>
            </div>

            <!-- Students Screen -->
            <div id="students" class="screen">    
                <div class="screen-header">        
                    <h1 class="screen-title">Student Management</h1>        
                    <p class="screen-subtitle">Manage all students</p>    
                </div>
    
                <!-- SIMPLE EXPORT BUTTONS -->   
                <div class="glass-card" style="margin-bottom: 20px; max-width: 700px; margin-left: auto; margin-right: auto;">        
                    <h3 class="card-title">üì• Export Students</h3>       
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">           
                        <button class="btn btn-success" onclick="exportStudentsToExcel()">              
                            üìä All Students Excel            
                        </button>           
                        <button class="btn btn-primary" onclick="exportStudentsByGrade()">               
                            üìë By Grade Excel            
                        </button>            
                        <button class="btn btn-secondary" onclick="exportCurrentGradeStudents()">                
                            üìÑ Current Tab Only            
                        </button>        
                    </div>   
                </div>
   
                <div class="grid-2">
                    <!-- Left Side - Student List by Grade Tabs -->
                    <div class="card">
                        <h3 class="card-title">Students by Grade</h3>
                        
                        <!-- Grade Tabs -->
                        <div style="display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap;">
                            <button class="grade-tab active" data-grade="all" onclick="switchGradeTab('all')">
                                All
                            </button>
                            <div id="gradeTabs"></div>
                        </div>

                        <!-- Search -->
                        <div class="form-group">
                            <input type="text" id="studentSearchBox" placeholder="Search by name, ID, or phone..." oninput="filterStudentsByTab()">
                        </div>

                        <!-- Student List -->
                        <div id="studentListByGrade" style="max-height: 500px; overflow-y: auto;"></div>
                    </div>

                    <!-- Right Side - Student Form -->
                    <div class="card">
                        <h3 class="card-title" id="studentFormTitle">Add New Student</h3>
                        
                        <div class="form-group">
                            <label>Name *</label>
                            <input type="text" id="studentNameInput" placeholder="Enter student name">
                        </div>

                        <div class="form-group">
                            <label>Birthday *</label>
                            <input type="date" id="studentBirthdayInput">
                        </div>

                        <div class="form-group">
                            <label>Gender *</label>
                            <select id="studentGenderInput">
                                <option value="">Select Gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Class *</label>
                            <select id="studentClassInput">
                                <option value="">Select Class</option>
                                <option value="A">A</option>
                                <option value="B">B</option>
                                <option value="C">C</option>
                                <option value="D">D</option>
                                <option value="E">E</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Grade *</label>
                            <select id="studentGradeInput"></select>
                        </div>

                        <div class="form-group">
                            <label>Student's Phone Number</label>
                            <input type="tel" id="studentPhoneInput" placeholder="e.g., 0771234567">
                        </div>

                        <div class="form-group">
                            <label>Parent's Phone Number *</label>
                            <input type="tel" id="parentPhoneInput" placeholder="e.g., 0771234567">
                        </div>

                        <div id="studentIdDisplaySection" style="display: none;">
    
                            <div class="form-group">        
                                <label>Student ID</label>        
                                <input type="text" id="studentIdDisplay" disabled style="background: #F3F4F6; font-weight: 600;">   
                            </div>
        
                            <div style="text-align: center; padding: 20px; background: #F3F4F6; border-radius: 12px; border: 2px dashed #D1D5DB;">        
                                <div style="font-size: 48px; margin-bottom: 12px;">üì±</div>    
                                <p style="font-weight: 600; color: #374151; margin-bottom: 8px;">QR Code Ready</p>
                                <p style="font-size: 14px; color: #6B7280; margin-bottom: 16px;" id="qrCodeText"></p>        
        
                                <button type="button" class="btn btn-primary" onclick="showQRCodeForCurrentStudent()">            
                                    üé´ View & Download QR Code        
                                </button>    
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="grid-2" style="gap: 12px; margin-top: 20px;">    
                            <button class="btn btn-primary" id="addStudentBtn" onclick="addNewStudent()">        
                                ‚ûï Add    
                            </button>    
                            <button class="btn btn-success" id="updateStudentBtn" style="display: none;" onclick="updateExistingStudent()">        
                                üíæ Update    
                            </button>    
                            <button class="btn btn-danger" id="deleteStudentBtn" style="display: none;" onclick="deleteExistingStudent()">       
                                üóëÔ∏è Delete    
                            </button>    
                            <button class="btn btn-secondary" id="clearStudentBtn" onclick="clearStudentForm()">       
                                ‚úñÔ∏è Clear    
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Timetable Screen -->
            <div id="timetable" class="screen">
                <div class="screen-header">
                    <h1 class="screen-title">Timetable</h1>
                    <p class="screen-subtitle" id="subjectDisplay">Subject: Mathematics</p>
                </div>
                <button class="btn btn-primary" onclick="showAddTimetable()" style="margin-bottom: 20px;">‚ûï Add Class</button>
                <div class="card">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Day</th>
                                    <th>Time</th>
                                    <th>Grade</th>
                                    <th>Notes</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="timetableTableBody">
                                <tr><td colspan="5" style="text-align: center; padding: 40px; color: #6B7280;">No classes scheduled</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Attendance Screen -->
            <div id="attendance" class="screen">  
                <div style="max-width: 1000px; margin: 0 auto; padding: 20px;">      
                    <div class="screen-header">            
                        <h1 class="screen-title">Mark Attendance</h1>         
                        <p class="screen-subtitle">Track student attendance</p>     
                    </div>

                    <!-- Step 1 & 2: Select Class and Date -->     
                    <div class="card">           
                        <h3 class="card-title">Step 1 & 2: Select Class and Date</h3>           
            
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div class="form-group">
                                <label>Select Class *</label>                    
                                <select id="attendanceClassSelect" style="width: 100%; padding: 12px; border: 1px solid #D1D5DB; border-radius: 8px; font-size: 16px;">                       
                                    <option value="">Choose a class</option>        
                                    <option value="06">Grade 06</option>                        
                                    <option value="07">Grade 07</option>                        
                                    <option value="08">Grade 08</option>                        
                                    <option value="09">Grade 09</option>                        
                                    <option value="10">Grade 10</option>                       
                                    <option value="11">Grade 11</option>                       
                                    <option value="12">Grade 12</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Select Date *</label>                 
                                <input type="date" id="attendanceDateSelect" style="width: 100%; padding: 12px; border: 1px solid #D1D5DB; border-radius: 8px; font-size: 16px;">
                            </div>
                        </div>
            
                        <div style="display: flex; gap: 12px;">
                            <button class="btn btn-primary" onclick="loadAttendanceStudents()" style="flex: 1;">
                                üìã Load Students
                            </button>
                            <button class="btn btn-secondary" onclick="openQRScanner('attendance')">        
                                üì∑ Scan QR    
                            </button>    
                            <button class="btn btn-secondary" onclick="manualQRInput('attendance')">        
                                ‚å®Ô∏è Manual Entry    
                            </button>
                        </div>        
                    </div>

                    <!-- Step 4: Mark Present/Absent -->
                    <div class="card" id="attendanceStudentCard" style="display: none;">
                        <h3 class="card-title">Step 4: Mark Attendance</h3>
            
                        <!-- Stats -->           
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 25px;">                
                            <div style="background: #F3F4F6; padding: 15px; border-radius: 10px; text-align: center;">                    
                                <p style="font-size: 14px; color: #6B7280; margin-bottom: 5px;">Total Students</p>                    
                                <h3 style="font-size: 28px; font-weight: bold; color: #1F2937;" id="attendanceTotalCount">0</h3>                
                            </div>                
                            <div style="background: #D1FAE5; padding: 15px; border-radius: 10px; text-align: center;">                    
                                <p style="font-size: 14px; color: #065F46; margin-bottom: 5px;">Present</p>                    
                                <h3 style="font-size: 28px; font-weight: bold; color: #065F46;" id="attendancePresentCount">0</h3>                
                            </div>                
                            <div style="background: #FEE2E2; padding: 15px; border-radius: 10px; text-align: center;">                    
                                <p style="font-size: 14px; color: #991B1B; margin-bottom: 5px;">Absent</p>                    
                                <h3 style="font-size: 28px; font-weight: bold; color: #991B1B;" id="attendanceAbsentCount">0</h3>                
                            </div>            
                        </div>
            
                        <!-- Student List -->
                        <div id="attendanceStudentsList"></div>

                        <!-- Step 5: Save -->            
                        <button class="btn btn-success" onclick="saveAttendanceData()" style="margin-top: 20px; width: 100%;">                
                            üíæ Step 5: Save Attendance
                        </button>        
                    </div>
                </div>
            </div>

            <!-- Payments Screen -->
            <div id="payments" class="screen">
                <div class="screen-header">
                    <h1 class="screen-title">Payment Management</h1>
                    <p class="screen-subtitle">Manage student fee payments</p>
                </div>

                <div class="card">
                    <h3 class="card-title">Record Payment</h3>
                    
                    <div style="display: flex; gap: 12px; margin-bottom: 20px;">    
                        <button class="btn btn-primary" onclick="openQRScanner('payment')" style="flex: 1;">        
                            üì∑ Scan QR Code    
                        </button>    
                        <button class="btn btn-secondary" onclick="manualQRInput('payment')">        
                            ‚å®Ô∏è Manual Entry
                        </button>
                    </div>

                    <div class="form-group">
                        <label>Student ID *</label>
                        <input type="text" id="paymentStudentId" placeholder="Enter student ID or scan QR">
                    </div>

                    <div class="form-group">
                        <label>Class (Auto-filled)</label>
                        <input type="text" id="paymentClass" placeholder="Will auto-fill after entering ID" disabled>
                    </div>

                    <div class="form-group">
                        <label>Month *</label>
                        <select id="paymentMonthDropdown">
                            <option value="">Select Month</option>
                            <option value="January">January</option>
                            <option value="February">February</option>
                            <option value="March">March</option>
                            <option value="April">April</option>
                            <option value="May">May</option>
                            <option value="June">June</option>
                            <option value="July">July</option>
                            <option value="August">August</option>
                            <option value="September">September</option>
                            <option value="October">October</option>
                            <option value="November">November</option>
                            <option value="December">December</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Amount *</label>
                        <input type="number" id="paymentAmountInput" placeholder="Enter amount">
                    </div>

                    <div class="form-group">
                        <label>Payment Status *</label>
                        <select id="paymentStatusDropdown">
                            <option value="Paid">Paid</option>
                            <option value="Unpaid">Unpaid</option>
                            <option value="Free Card">Free Card</option>
                        </select>
                    </div>

                    <button class="btn btn-primary" onclick="recordPayment()">
                        üíæ Record Payment
                    </button>
                </div>

                <div class="card">
                    <h3 class="card-title">Payment History</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Student ID</th>
                                    <th>Student Name</th>
                                    <th>Class</th>
                                    <th>Month</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="paymentHistoryTable">
                                <tr>
                                    <td colspan="7" style="text-align: center; padding: 40px; color: #6B7280;">
                                        No payment records yet
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Reports Screen -->
            <div id="reports" class="screen">
                <div class="screen-header">
                    <h1 class="screen-title">Reports</h1>
                </div>
                <div class="card">
                    <h3 class="card-title">Generate Report</h3>
                    <div class="form-group">
                        <label>Report Type</label>
                        <select id="reportType">
                            <option value="attendance">Monthly Attendance by Grade</option>
                            <option value="payment">Payment Collection Summary</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Month</label>
                        <input type="month" id="reportMonth">
                    </div>
                    <div class="form-group">
                        <label>Grade</label>
                        <select id="reportGrade">
                            <option value="all">All Grades</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="generateReport()">üìä Generate</button>
                    <button class="btn btn-success" onclick="exportToExcel()" style="margin-top: 12px;">üì• Export Excel</button>
                </div>
                <div class="card" id="reportPreview" style="display: none;">
                    <h3 class="card-title">Preview</h3>
                    <div id="reportContent"></div>
                </div>
            </div>
       
            <!-- QR Scanner Modal -->
            <div class="modal" id="qrScannerModal">    
                <div class="modal-content" style="max-width: 600px;">        
                    <div class="modal-header">            
                        <h3 class="modal-title">üì∑ Scan QR Code</h3>            
                        <button class="close-btn" onclick="closeQRScanner()">‚úñ</button>
                    </div>        
                    <div id="qr-reader" style="width: 100%;"></div>                
                    <div style="margin-top: 20px; padding: 15px; background: #F3F4F6; border-radius: 8px;">            
                        <p style="margin: 0; font-size: 14px; color: #6B7280;">                
                            üì± Position the QR code in front of your camera            
                        </p>
                        <button class="btn btn-secondary" onclick="switchCamera()" style="margin-top: 15px;">            
                            üîÑ Switch Camera        
                        </button>
                    </div>
               
                    <div id="qr-result" style="margin-top: 15px; padding: 15px; background: #D1FAE5; border-radius: 8px; display: none;">            
                        <p style="margin: 0; font-weight: 600; color: #065F46;">             
                            ‚úÖ Scanned: <span id="qr-scanned-id"></span>            
                        </p>        
                    </div>    
                </div>
            </div>

            <!-- Subscription Screen -->
            <div id="subscription" class="screen">    
                <div class="screen-header">        
                    <h1 class="screen-title">Subscription Plans</h1>       
                    <p class="screen-subtitle">Choose the plan that fits your needs</p>    
                </div>
    
                <!-- Current Subscription Status -->    
                <div class="glass-card" style="margin-bottom: 30px; max-width: 800px; margin-left: auto; margin-right: auto;">       
                    <h3 class="card-title">üìã Current Subscription</h3>
             
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">           
                        <div style="background: rgba(59,130,246,0.2); padding: 15px; border-radius: 12px;">                
                            <p style="font-size: 13px; color: rgba(255,255,255,0.7); margin-bottom: 5px;">Current Plan</p>               
                            <p style="font-size: 20px; font-weight: 700; color: #fff; margin: 0;" id="currentPlanName">Free Trial</p>            
                        </div>            
                        <div style="background: rgba(16,185,129,0.2); padding: 15px; border-radius: 12px;">                
                            <p style="font-size: 13px; color: rgba(255,255,255,0.7); margin-bottom: 5px;">Status</p>                
                            <p style="font-size: 20px; font-weight: 700; color: #fff; margin: 0;" id="subscriptionStatus">Active</p>            
                        </div>            
                        <div style="background: rgba(245,158,11,0.2); padding: 15px; border-radius: 12px;">                
                            <p style="font-size: 13px; color: rgba(255,255,255,0.7); margin-bottom: 5px;">Students</p>                
                            <p style="font-size: 20px; font-weight: 700; color: #fff; margin: 0;"><span id="currentStudents">0</span> / <span id="maxStudents">10</span></p>            
                        </div>            
                        <div style="background: rgba(139,92,246,0.2); padding: 15px; border-radius: 12px;">                
                            <p style="font-size: 13px; color: rgba(255,255,255,0.7); margin-bottom: 5px;">Valid Until</p>                
                            <p style="font-size: 20px; font-weight: 700; color: #fff; margin: 0;" id="subscriptionEndDate">-</p>            
                        </div>   
                    </div>        
                    <div id="subscriptionWarning" style="display: none; background: rgba(239,68,68,0.2); padding: 15px; border-radius: 12px; border: 1px solid rgba(239,68,68,0.3);">            
                        <p style="margin: 0; color: #FEE2E2; font-weight: 600;">‚ö†Ô∏è <span id="warningMessage"></span></p>        
                    </div>    
                </div>
    
                <!-- Pricing Plans -->    
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; max-width: 1200px; margin: 0 auto;">
               
                    <!-- Free Trial Plan -->        
                    <div class="glass-card" style="position: relative;">            
                        <div style="background: rgba(107,114,128,0.3); padding: 8px 16px; border-radius: 20px; display: inline-block; margin-bottom: 15px;">                
                            <span style="font-size: 12px; font-weight: 600; color: #fff;">FREE TRIAL</span>            
                        </div>         
            
                        <h3 style="font-size: 32px; font-weight: 700; color: #fff; margin-bottom: 10px;">                
                            Free            
                        </h3>            
                        <p style="color: rgba(255,255,255,0.7); margin-bottom: 20px;">Perfect for trying out</p>
                        
                        <div style="border-top: 1px solid rgba(255,255,255,0.2); padding-top: 20px; margin-bottom: 20px;">                
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">                    
                                <span style="color: #10B981; font-size: 20px;">‚úì</span>                    
                                <span style="color: rgba(255,255,255,0.9);">Up to 10 students</span>                
                            </div>                
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">                    
                                <span style="color: #10B981; font-size: 20px;">‚úì</span>                    
                                <span style="color: rgba(255,255,255,0.9);">Attendance tracking</span>                
                            </div>                
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">                    
                                <span style="color: #10B981; font-size: 20px;">‚úì</span>                    
                                <span style="color: rgba(255,255,255,0.9);">Payment records</span>                
                            </div>                
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">                    
                                <span style="color: #EF4444; font-size: 20px;">‚úó</span>                    
                                <span style="color: rgba(255,255,255,0.5);">Advanced reports</span>                
                            </div>                
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">                    
                                <span style="color: #EF4444; font-size: 20px;">‚úó</span>                    
                                <span style="color: rgba(255,255,255,0.5);">Unlimited students</span>                
                            </div>            
                        </div>            
            
                        <button class="btn btn-secondary" onclick="selectPlan('free_trial')" id="btnFreeTrial">                
                            Current Plan            
                        </button>        
                    </div>
        
                    <!-- Monthly Plan -->       
                    <div class="glass-card" style="position: relative; border: 2px solid #10B981;">            
                        <div style="position: absolute; top: -12px; right: 20px; background: #10B981; padding: 4px 12px; border-radius: 12px;">                
                            <span style="font-size: 11px; font-weight: 700; color: #fff;">POPULAR</span>           
                        </div>
                       
                        <div style="background: rgba(16,185,129,0.3); padding: 8px 16px; border-radius: 20px; display: inline-block; margin-bottom: 15px;">              
                            <span style="font-size: 12px; font-weight: 600; color: #D1FAE5;">MONTHLY</span>            
                        </div>
                        
                        <h3 style="font-size: 32px; font-weight: 700; color: #fff; margin-bottom: 5px;">                
                            LKR.1000.00<span style="font-size: 16px; font-weight: 400; color: rgba(255,255,255,0.7);">/month</span>          
                        </h3>
                        <p style="color: rgba(255,255,255,0.7); margin-bottom: 20px;">Best for small classes</p>
                        
                        <div style="border-top: 1px solid rgba(255,255,255,0.2); padding-top: 20px; margin-bottom: 20px;">                
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">                    
                                <span style="color: #10B981; font-size: 20px;">‚úì</span>                    
                                <span style="color: rgba(255,255,255,0.9);">Unlimited students</span>                
                            </div>                
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">                    
                                <span style="color: #10B981; font-size: 20px;">‚úì</span>                    
                                <span style="color: rgba(255,255,255,0.9);">All attendance features</span>                
                            </div>                
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">                    
                                <span style="color: #10B981; font-size: 20px;">‚úì</span>                    
                                <span style="color: rgba(255,255,255,0.9);">Advanced reports</span>                
                            </div>                
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">                   
                                <span style="color: #10B981; font-size: 20px;">‚úì</span>                    
                                <span style="color: rgba(255,255,255,0.9);">Excel exports</span>                
                            </div>                
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">                    
                                <span style="color: #10B981; font-size: 20px;">‚úì</span>                    
                                <span style="color: rgba(255,255,255,0.9);">Priority support</span>                
                            </div>            
                        </div>           
                        <button class="btn btn-success" onclick="initiatePayment('monthly')" id="btnMonthly">                
                            Subscribe Monthly            
                        </button>        
                    </div>
    
                    <!-- Annual Plan -->        
                    <div class="glass-card" style="position: relative; border: 2px solid #3B82F6;">            
                        <div style="position: absolute; top: -12px; right: 20px; background: #3B82F6; padding: 4px 12px; border-radius: 12px;">               
                            <span style="font-size: 11px; font-weight: 700; color: #fff;">SAVE 20%</span>           
                        </div>
                       
                        <div style="background: rgba(59,130,246,0.3); padding: 8px 16px; border-radius: 20px; display: inline-block; margin-bottom: 15px;">                
                            <span style="font-size: 12px; font-weight: 600; color: #DBEAFE;">ANNUAL</span>           
                        </div>
                       
                        <h3 style="font-size: 32px; font-weight: 700; color: #fff; margin-bottom: 5px;">                
                            LKR.9600.00<span style="font-size: 16px; font-weight: 400; color: rgba(255,255,255,0.7);">/year</span>            
                        </h3>
                        
                        <p style="color: rgba(255,255,255,0.7); margin-bottom: 20px;">Save LKR.2400.00/year</p>
                        
                        <div style="border-top: 1px solid rgba(255,255,255,0.2); padding-top: 20px; margin-bottom: 20px;">               
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">                    
                                <span style="color: #10B981; font-size: 20px;">‚úì</span>                   
                                <span style="color: rgba(255,255,255,0.9);">Everything in Monthly</span>                
                            </div>                
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">                    
                                <span style="color: #10B981; font-size: 20px;">‚úì</span>                    
                                <span style="color: rgba(255,255,255,0.9);">20% discount</span>                
                            </div>                
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">                    
                                <span style="color: #10B981; font-size: 20px;">‚úì</span>                    
                                <span style="color: rgba(255,255,255,0.9);">Priority updates</span>                
                            </div>                
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">                    
                                <span style="color: #10B981; font-size: 20px;">‚úì</span>                    
                                <span style="color: rgba(255,255,255,0.9);">Dedicated support</span>                
                            </div>                
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">                    
                                <span style="color: #10B981; font-size: 20px;">‚úì</span>                    
                                <span style="color: rgba(255,255,255,0.9);">No ads (coming soon)</span>                
                            </div>            
                        </div>
                        
                        <button class="btn btn-primary" onclick="initiatePayment('annual')" id="btnAnnual">                
                            Subscribe Annual            
                        </button>        
                    </div>    
                </div>

                <!-- Payment History -->
                <div class="glass-card" style="margin-top: 40px; max-width: 1000px; margin-left: auto; margin-right: auto;">  
                    <h3 class="card-title">üí≥ Payment History</h3>
       
                    <div class="table-container">        
                        <table>            
                            <thead>                
                                <tr>                    
                                    <th>Date</th>                    
                                    <th>Order ID</th>                    
                                    <th>Plan</th>                    
                                    <th>Amount</th>                   
                                    <th>Status</th>                
                                </tr>            
                            </thead>           
                            <tbody id="paymentHistoryTableBody">                
                                <tr>                    
                                    <td colspan="5" style="text-align: center; padding: 40px; color: rgba(255,255,255,0.7);">                        
                                        No payment history yet                   
                                    </td>                
                                </tr>            
                            </tbody>        
                        </table>    
                    </div>
                </div>
    
                <!-- FAQs -->    
                <div class="glass-card" style="margin-top: 40px; max-width: 800px; margin-left: auto; margin-right: auto;">        
                    <h3 class="card-title">‚ùì Frequently Asked Questions</h3>        
        
                    <div style="margin-bottom: 20px;">           
                        <h4 style="color: #fff; font-size: 16px; margin-bottom: 8px;">Can I cancel anytime?</h4>            
                        <p style="color: rgba(255,255,255,0.7); font-size: 14px;">Yes! You can cancel your subscription at any time. You'll continue to have access until the end of your billing period.</p>        
                    </div>
                
                    <div style="margin-bottom: 20px;">            
                        <h4 style="color: #fff; font-size: 16px; margin-bottom: 8px;">What happens to my data if I cancel?</h4>            
                        <p style="color: rgba(255,255,255,0.7); font-size: 14px;">Your data is always yours. You can export all your data before canceling. We keep your data for 30 days after cancellation.</p>      
                    </div>
        
                    <div style="margin-bottom: 20px;">                  
                        <h4 style="color: #fff; font-size: 16px; margin-bottom: 8px;">Can I upgrade or downgrade my plan?</h4>            
                        <p style="color: rgba(255,255,255,0.7); font-size: 14px;">Yes! You can change your plan at any time. Upgrades are immediate, and downgrades take effect at the end of your billing period.</p>        
                    </div>    
                </div>
            </div>

            <!-- Settings Screen -->
            <div id="settings" class="screen">    
                <div class="screen-header">        
                    <h1 class="screen-title">Settings</h1>   
                </div>

                <!-- Data Synchronization Card - NEW -->
                <div class="card">
                    <h3 class="card-title">üíæ Data Synchronization</h3>
        
                    <!-- Sync Status Row -->
                    <div style="display: flex; align-items: center; justify-content: space-between; gap: 20px; margin-bottom: 20px; padding: 16px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                        <div style="flex: 1;">
                            <p style="margin: 0 0 4px 0; font-weight: 600; font-size: 14px; color: rgba(255,255,255,0.9);">Last Synced</p>
                            <p id="lastSyncTime" style="margin: 0; color: rgba(255,255,255,0.7); font-size: 14px;">Never</p>
                        </div>
            
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <!-- Sync Indicator -->
                            <div id="syncIndicator" style="width: 10px; height: 10px; background: #10b981; border-radius: 50%; box-shadow: 0 0 10px rgba(16,185,129,0.5);"></div>
                
                            <!-- Sync Button -->
                            <button class="btn btn-primary" onclick="syncNowManual()" id="syncNowBtn">
                                <span id="syncNowBtnText">üîÑ Sync Now</span>
                            </button>
                        </div>
                    </div>
        
                    <!-- Sync Status Message -->
                    <div id="syncStatusMessage" style="display: none; padding: 12px 16px; border-radius: 8px; margin-bottom: 16px;">
                        <p id="syncStatusText" style="margin: 0; font-size: 14px; font-weight: 500;"></p>
                    </div>
        
                    <!-- Sync Statistics -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; margin-bottom: 20px;">
                        <div style="padding: 12px; background: rgba(59,130,246,0.2); border-radius: 8px; text-align: center; border: 1px solid rgba(59,130,246,0.3);">
                            <p style="margin: 0 0 4px 0; font-size: 12px; color: rgba(255,255,255,0.7); text-transform: uppercase; letter-spacing: 0.5px;">Students</p>
                            <p id="syncStudentsCount" style="margin: 0; font-size: 20px; font-weight: 700; color: #fff;">0</p>
                        </div>
            
                        <div style="padding: 12px; background: rgba(16,185,129,0.2); border-radius: 8px; text-align: center; border: 1px solid rgba(16,185,129,0.3);">
                            <p style="margin: 0 0 4px 0; font-size: 12px; color: rgba(255,255,255,0.7); text-transform: uppercase; letter-spacing: 0.5px;">Classes</p>
                            <p id="syncClassesCount" style="margin: 0; font-size: 20px; font-weight: 700; color: #fff;">0</p>
                        </div>
            
                        <div style="padding: 12px; background: rgba(245,158,11,0.2); border-radius: 8px; text-align: center; border: 1px solid rgba(245,158,11,0.3);">
                            <p style="margin: 0 0 4px 0; font-size: 12px; color: rgba(255,255,255,0.7); text-transform: uppercase; letter-spacing: 0.5px;">Payments</p>
                            <p id="syncPaymentsCount" style="margin: 0; font-size: 20px; font-weight: 700; color: #fff;">0</p>
                        </div>
                    </div>
        
                    <!-- Info Text -->
                    <p style="color: rgba(255,255,255,0.7); font-size: 13px; margin: 0; line-height: 1.5;">
                        ‚ÑπÔ∏è Your data is automatically synced with the cloud in real-time. Use the "Sync Now" button to manually force synchronization or check for updates.
                    </p>
                </div>

                <!-- Account Card -->
                <div class="card">                    
                    <h3 class="card-title">üë§ Account</h3>
            
                    <div style="background: rgba(59,130,246,0.2); padding: 15px; border-radius: 12px; margin-bottom: 15px;">                            
                        <p style="font-size: 13px; color: rgba(255,255,255,0.7); margin-bottom: 5px;">Your Teacher ID:</p>                      
                        <p style="font-size: 16px; font-weight: 600; color: #fff; font-family: monospace;" id="teacherIdDisplay"></p>                       
                        <button class="btn btn-secondary" onclick="copyTeacherId()" style="margin-top: 10px; width: auto;">                
                            üìã Copy ID                      
                        </button>                   
                    </div>
            
                    <p style="font-size: 13px; color: rgba(255,255,255,0.7); margin-bottom: 15px;">                            
                        üí° Save this ID to access your data from any device                    
                    </p>    
                </div>

                <!-- Cloud Sync Status - NEW SECTION -->
                <div class="card">
                    <h3 class="card-title">‚òÅÔ∏è Cloud Synchronization</h3>
        
                    <div style="background: rgba(16,185,129,0.2); padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 1px solid rgba(16,185,129,0.3);">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                            <span style="font-size: 20px;">‚úÖ</span>
                            <span style="font-weight: 600; color: #D1FAE5;">Cloud Sync Active</span>
                        </div>
                        <p style="font-size: 13px; color: rgba(255,255,255,0.7); margin: 0;">
                            Your data is automatically saved to the cloud in real-time
                        </p>
                    </div>
        
                    <!-- Last Saved Info -->
                    <div style="background: rgba(255,255,255,0.1); padding: 12px; border-radius: 8px; margin-bottom: 20px;">
                        <p style="font-size: 14px; color: rgba(255,255,255,0.8); margin: 0;">
                            üìÖ Last Saved: <span id="lastSavedTime" style="font-weight: 600; color: #fff;">Never</span>
                        </p>
                    </div>
        
                    <p style="color: rgba(255,255,255,0.7); font-size: 13px; margin: 0 0 8px 0; line-height: 1.6;">
                        ‚úì Works on all your devices<br>
                        ‚úì Always up-to-date<br>
                        ‚úì Protected by Firebase security<br>
                        ‚úì No manual saving required
                    </p>
                </div>

                <!-- Grades Card -->   
                <div class="card">
                    <h3 class="card-title">Grades</h3>        
                    <div id="gradesList"></div>       
                    <div style="display: flex; gap: 12px; margin-top: 16px;">            
                        <input type="text" id="newGrade" placeholder="e.g., 13" style="flex: 1;">            
                        <button class="btn btn-primary" onclick="addGrade()">‚ûï Add</button>        
                    </div>
                    <h3 class="card-title">Classes</h3>
                    <div id="classSettingsContainer" style="margin-top: 24px; padding-top: 24px; border-top: 2px solid #e5e7eb;">                 
                    </div>
                </div>

                <!-- Subject Card -->    
                <div class="card">        
                    <h3 class="card-title">Subject</h3>        
                    <div class="form-group">            
                        <label>Subject Name</label>            
                        <input type="text" id="subjectNameInput" value="Mathematics">        
                    </div>        
                    <button class="btn btn-primary" onclick="saveSubject()">üíæ Save</button>    
                </div>

                <!-- Manual Device Backup (Optional) - UPDATED -->
                <div class="card">
                    <h3 class="card-title">üíæ Manual Device Backup (Optional)</h3>
        
                    <p style="color: rgba(255,255,255,0.7); font-size: 14px; margin-bottom: 16px; line-height: 1.6;">
                        Download a backup file to your device for safekeeping. This is <strong>optional</strong> since your data is already safely stored in the cloud.
                    </p>
        
                    <button class="btn btn-primary" onclick="downloadBackup()" style="margin-bottom: 12px;">
                        üíæ Download Backup File
                    </button>
        
                    <button class="btn btn-secondary" onclick="uploadBackup()" style="margin-bottom: 20px;">
                        üìÇ Restore from Backup File
                    </button>
        
                    <div style="background: rgba(255,255,255,0.1); padding: 12px; border-radius: 8px;">
                        <p style="font-size: 14px; color: rgba(255,255,255,0.8); margin: 0;">
                            üì¶ Last Manual Backup: <span id="lastBackupTime" style="font-weight: 600; color: #fff;">Never</span>
                        </p>
                    </div>
                </div>

                <!-- Data Statistics -->
                <div class="card">
                    <h3 class="card-title">üìä Data Statistics</h3>
        
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 20px;">
                        <div style="background: rgba(59,130,246,0.2); padding: 12px; border-radius: 8px; text-align: center;">
                            <p style="font-size: 12px; color: rgba(255,255,255,0.7); margin-bottom: 4px;">Students</p>
                            <p style="font-size: 24px; font-weight: 700; color: #fff; margin: 0;" id="statsStudents">0</p>
                        </div>
                        <div style="background: rgba(16,185,129,0.2); padding: 12px; border-radius: 8px; text-align: center;">
                            <p style="font-size: 12px; color: rgba(255,255,255,0.7); margin-bottom: 4px;">Payments</p>
                            <p style="font-size: 24px; font-weight: 700; color: #fff; margin: 0;" id="statsPayments">0</p>
                        </div>
                        <div style="background: rgba(245,158,11,0.2); padding: 12px; border-radius: 8px; text-align: center;">
                            <p style="font-size: 12px; color: rgba(255,255,255,0.7); margin-bottom: 4px;">Classes</p>
                            <p style="font-size: 24px; font-weight: 700; color: #fff; margin: 0;" id="statsTimetable">0</p>
                        </div>
                        <div style="background: rgba(139,92,246,0.2); padding: 12px; border-radius: 8px; text-align: center;">
                            <p style="font-size: 12px; color: rgba(255,255,255,0.7); margin-bottom: 4px;">Attendance Records</p>
                            <p style="font-size: 24px; font-weight: 700; color: #fff; margin: 0;" id="statsAttendance">0</p>
                        </div>
                    </div>
        
                    <!-- Export Data -->
                    <h4 style="color: #fff; font-size: 16px; margin-bottom: 12px;">Export Data</h4>
                    <button class="btn btn-success" onclick="exportAllDataToExcel()" style="margin-bottom: 20px;">
                        üìä Export All Data to Excel
                    </button>
                </div>

                <!-- Danger Zone -->
                <div class="card">
                    <div style="background: rgba(239,68,68,0.2); padding: 15px; border-radius: 12px; border: 1px solid rgba(239,68,68,0.3);">
                        <h4 style="color: #FEE2E2; font-size: 16px; margin-bottom: 8px;">‚ö†Ô∏è Danger Zone</h4>
                        <p style="font-size: 13px; color: rgba(255,255,255,0.7); margin-bottom: 12px;">
                            This action cannot be undone. All data will be permanently deleted from the cloud.
                        </p>
                        <button class="btn btn-danger" onclick="clearAllData()">
                            üóëÔ∏è Clear All Data
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- QR Code Display Modal -->
            <div class="modal" id="qrCodeDisplayModal">    
                <div class="modal-content" style="max-width: 500px;">        
                    <div class="modal-header">            
                        <h3 class="modal-title">Student QR Code</h3>            
                        <button class="close-btn" onclick="closeQRCodeDisplay()">‚úñ</button>        
                    </div>
        
                    <div style="text-align: center;">            
                        <div style="background: #F3F4F6; padding: 20px; border-radius: 12px; margin-bottom: 20px;">                
                            <p style="font-size: 18px; font-weight: 600; color: #1F2937; margin-bottom: 5px;" id="qrStudentName"></p>                
                            <p style="font-size: 14px; color: #6B7280; margin-bottom: 15px;" id="qrStudentDetails"></p>
                            
                            <!-- QR Code will be generated here -->                                
                            <div id="qrcode-container" style="display: flex; justify-content: center; margin: 20px 0;"></div>                                
                            
                            <p style="font-size: 16px; font-weight: 600; color: #2563EB;" id="qrStudentId"></p>            
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">                
                            <button class="btn btn-primary" onclick="downloadQRCode()">        
                                üíæ Download QR Code            
                            </button>                
                            <button class="btn btn-success" onclick="downloadStudentCard()">                    
                                üé´ Download ID Card        
                            </button>            
                        </div>        
                    </div>    
                </div>
            </div>
    
            <!-- Timetable Modal -->   
            <div class="modal" id="timetableModal">       
                <div class="modal-content">           
                    <div class="modal-header">                
                        <h3 class="modal-title" id="timetableModalTitle">Add Class</h3>                
                        <button class="close-btn" onclick="closeTimetableModal()">‚úñ</button>            
                    </div>           
                    <div class="form-group">                
                        <label>Day</label>                
                        <select id="timetableDay">                    
                            <option>Monday</option>                   
                            <option>Tuesday</option>                    
                            <option>Wednesday</option>                    
                            <option>Thursday</option>                    
                            <option>Friday</option>                   
                            <option>Saturday</option>                    
                            <option>Sunday</option>               
                        </select>            
                    </div>            
                    <div class="form-group">                
                        <label>Time</label>                
                        <input type="time" id="timetableTime">           
                    </div>            
                    <div class="form-group">                
                        <label>Grade</label>                
                        <select id="timetableGrade"></select>            
                    </div>           
                    <div class="form-group">                
                        <label>Notes</label>               
                        <input type="text" id="timetableNotes" placeholder="e.g., Room 101">           
                    </div>            
                    <button class="btn btn-primary" onclick="saveTimetableEntry()">üíæ Save</button>        
                </div>    
            </div>
    
            <!-- Payment Modal -->
            <div class="modal" id="paymentModal">        
                <div class="modal-content">            
                    <div class="modal-header">                
                        <h3 class="modal-title">Record Payment</h3>                
                        <button class="close-btn" onclick="closePaymentModal()">‚úñ</button>            
                    </div>            
                    <div class="form-group">                
                        <label>Amount</label>                
                        <input type="number" id="paymentAmount" placeholder="Enter amount">            
                    </div>            
                    <div class="form-group">                
                        <label>Date</label>                
                        <input type="date" id="paymentDate">            
                    </div>            
                    <div class="form-group">                
                        <label>Month</label>                
                        <input type="month" id="paymentMonth">            
                    </div>            
                    <div class="form-group">                
                        <label>Method</label>                
                        <select id="paymentMethod">                    
                            <option>Cash</option>                    
                            <option>Bank Transfer</option>                    
                            <option>Mobile Payment</option>              
                        </select>            
                    </div>         
                    <button class="btn btn-primary" onclick="savePayment()">üíæ Record</button>        
                </div>    
            </div>
        </div>
    </div>
    <footer class="app-footer">  
        ¬© <span id="year"></span> Class Manager WebApp. All rights reserved.
    </footer>
    <script type="text/javascript" src="https://www.payhere.lk/lib/payhere.js"></script>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>  
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="Js/firebase-config.js"></script>
    <script src="Js/core-functions.js"></script>
    <script src="Js/admin-users.js"></script>
    <script src="Js/admin-analytics.js"></script>
    <script src="Js/admin-management.js"></script>
    <script src="Js/subscription-helpers.js"></script>
    <script src="Js/Save.js"></script>
    <script src="Js/Settings.js"></script>
    <script src="Js/Students.js"></script>
    <script src="Js/Subscription.js"></script>
    <script src="Js/Attendance.js"></script>
    <script src="Js/Excel Export.js"></script>
    <script src="Js/Payhere.js"></script>
    <script src="Js/Payments.js"></script>
    <script src="Js/Reports.js"></script>
    <script src="Js/Timetable.js"></script>
    <script src="Js/QR Codes.js"></script>
    <script src="Js/"></script>
    
    <script type="module">     
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    </script>
    <script>  
        document.getElementById("year").textContent = new Date().getFullYear();
    </script>
</body>
</html>
